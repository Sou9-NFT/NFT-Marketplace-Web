{% extends 'base.html.twig' %}

{% block title %}Edit Category{% endblock %}

{% block body %}
    <div class="container mt-4">
        <h1>Edit Category</h1>

        {{ form_start(form) }}
        <div class="row">
            <div class="col-md-6">
                <div class="mb-3">
                    {{ form_label(form.name) }}
                    {{ form_widget(form.name) }}
                    {{ form_errors(form.name) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.type) }}
                    {{ form_widget(form.type) }}
                    {{ form_errors(form.type) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.description) }}
                    {{ form_widget(form.description) }}
                    {{ form_errors(form.description) }}
                </div>

                <div class="mb-3">
                    <label>Allowed MIME Types</label>
                    <div class="mime-types-wrapper"
                         data-prototype="{{ form_widget(form.allowedMimeTypes.vars.prototype)|e('html_attr') }}">
                        {% for mimeTypeField in form.allowedMimeTypes %}
                            <div class="input-group mb-2">
                                {{ form_widget(mimeTypeField) }}
                                <button type="button" class="btn btn-danger remove-mime-type">Remove</button>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-secondary add-mime-type">Add MIME Type</button>
                    {{ form_errors(form.allowedMimeTypes) }}
                </div>
            </div>
        </div>

        <div class="mb-3">
            <button type="submit" class="btn btn-primary">Save</button>
            <a href="{{ path('app_category_index') }}" class="btn btn-secondary">Back to list</a>
        </div>
        {{ form_end(form) }}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            let mimeTypesWrapper = document.querySelector('.mime-types-wrapper');
            let addButton = document.querySelector('.add-mime-type');
            let prototype = mimeTypesWrapper.dataset.prototype;
            let index = document.querySelectorAll('.mime-types-wrapper .input-group').length;

            addButton.addEventListener('click', function() {
                let newForm = prototype.replace(/__name__/g, index);
                let div = document.createElement('div');
                div.classList.add('input-group', 'mb-2');
                div.innerHTML = newForm + '<button type="button" class="btn btn-danger remove-mime-type">Remove</button>';
                mimeTypesWrapper.appendChild(div);
                index++;
            });

            mimeTypesWrapper.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-mime-type')) {
                    e.target.closest('.input-group').remove();
                }
            });
        });
    </script>
{% endblock %}
